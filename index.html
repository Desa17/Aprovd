<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#FF002F">
  <meta name="description" content="Tienda de Juguetes Happy Store - productos divertidos y educativos">
  <meta name="keywords" content="juguetes, tienda, Happy Store, niños, diversión">
  <link rel="icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Fredoka+One&display=swap" rel="stylesheet">
  <title>Happy Store | Juguetes divertidos</title>

  <style>
    /* ================== BODY ================== */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }

    /* ================== HEADER Y TITULO ================== */
    header {
      text-align: center;
      margin-bottom: 30px;
    }

    #titulo-happy {
      font-family: 'Fredoka One', cursive;
      font-size: 2.2rem;
      line-height: 1.2;
      word-break: break-word;
    }

    #titulo-happy span {
      display: inline-block;
      font-weight: bold;
      transition: transform 0.3s, color 0.3s;
      font-size: inherit;
    }

    #titulo-happy span:nth-child(1) { color: #FF002F; transform: rotate(-5deg); }
    #titulo-happy span:nth-child(2) { color: #FF7F50; transform: rotate(3deg); }
    #titulo-happy span:nth-child(3) { color: #FFA500; transform: rotate(-2deg); }
    #titulo-happy span:nth-child(4) { color: #00BFFF; transform: rotate(4deg); }
    #titulo-happy span:nth-child(5) { color: #32CD32; transform: rotate(-3deg); }
    #titulo-happy span:nth-child(6) { color: #FF69B4; transform: rotate(2deg); }
    #titulo-happy span:nth-child(7) { color: #FF002F; transform: rotate(-4deg); }
    #titulo-happy span:nth-child(8) { color: #FF8C00; transform: rotate(3deg); }
    #titulo-happy span:nth-child(9) { color: #1E90FF; transform: rotate(-2deg); }
    #titulo-happy span:nth-child(10){ color: #32CD32; transform: rotate(2deg); }
    #titulo-happy span:nth-child(11){ color: #FF1493; transform: rotate(-3deg); }

    #titulo-happy span:hover {
      transform: scale(1.3) rotate(0deg);
      cursor: default;
    }

    /* Ajustes responsivos para título */
    @media (max-width: 480px) { #titulo-happy { font-size: 1.6rem; } }
    @media (min-width: 481px) and (max-width: 768px) { #titulo-happy { font-size: 2rem; } }

    /* ================== PRODUCTOS ================== */
    .productos-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .producto {
      width: 300px;
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 6px 15px rgba(255,0,47,0.15);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .producto:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(255,0,47,0.25);
    }

    .producto h3 {
      margin: 5px 0;
    }

    .producto p {
      margin: 5px 0;
    }

    /* ================== SLIDER ================== */
    .slider {
      position: relative;
      width: 100%;
      aspect-ratio: 1/1;
      overflow: hidden;
      border-radius: 12px;
      margin-bottom: 10px;
      cursor: grab;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
    }

    .slider img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
      transition: transform 0.3s;
      border-radius: 12px;
    }

    .slider img.active { display: block; }

    .slider-dots {
      text-align: center;
      margin-top: 8px;
    }

    .slider-dots span {
      display: inline-block;
      width: 12px;
      height: 12px;
      background-color: #ddd;
      border-radius: 50%;
      margin: 0 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .slider-dots span.active { background-color: #FF002F; }

    /* ================== ESTRELLAS ================== */
    






.estrellas {
  display: inline-flex;
  gap: 2px;
  margin-bottom: 0;
}

.estrella {
  font-size: 18px;
  position: relative;
}

.estrella.llena {
  color: #FF002F;
}

.estrella.vacia {
  color: #ddd;
}

.estrella.media {
  color: #ddd;
}

.estrella.media::before {
  content: "★";
  color: #FF002F;
  position: absolute;
  width: 50%;
  overflow: hidden;
}

    

    /* ================== BOTÓN ================== */
    button {
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #FF002F, #cc0026);
      color: #fff;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(255,0,47,0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(255,0,47,0.3);
    }

    @media (max-width:768px) { .producto { width: 90%; } }

    /* ================== MODAL ZOOM ================== */
    #zoomModal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
    }

    #zoomModal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      cursor: zoom-out;
      transition: transform 0.3s;
    }

    /* ================== FOOTER ================== */
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.9rem;
      color: #777;
    }

/* ================== PAGINACION PROFESIONAL ================== */
.paginacion-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
  margin-top: 30px;
  user-select: none;
}

.paginacion-container button {
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  background-color: #FF002F;
  color: #fff;
  font-size: 1rem;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(255,0,47,0.2);
  transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;

  /* --- NUEVAS LÍNEAS PARA CENTRAR CONTENIDO --- */
  display: flex;
  justify-content: center;
  align-items: center;
  line-height: 1;
  transform: translateY(0);
  }

.paginacion-container button:hover:not(:disabled) {
  background-color: #cc0026;

  
  box-shadow: 0 6px 12px rgba(255,0,47,0.3);
}

.paginacion-container button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

.paginacion-container .numero-pagina {
  min-width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  border-radius: 6px;
  background-color: #fff;
  color: #333;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s, color 0.3s;
}

.paginacion-container .numero-pagina:hover {
  background-color: #FF002F;
  color: #fff;
}

.paginacion-container .numero-pagina.active {
  background-color: #FF002F;
  color: #fff;
}
    
  </style>
</head>
<body>

<header>
  <h1 id="titulo-happy">
    <span>H</span><span>a</span><span>p</span><span>p</span><span>y</span>
    <span> </span>
    <span>S</span><span>t</span><span>o</span><span>r</span><span>e</span>
  </h1>
</header>

<main>
  <div id="productos" class="productos-container"></div>

  <div id="paginacion" class="paginacion-container"></div>
  
</main>

<div id="zoomModal">
  <img id="zoomImg" alt="Imagen ampliada del producto">
</div>

<footer>
  <p>© 2026 Happy Store | Todos los derechos reservados</p>
</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz5jmczBym2G_VaClZiNriAqYTpF-6qDSnRzWhRaSNHtGlDHECy03PhJT0polNG00endw/exec";
let listaProductos = [];


  let paginaActual = 1;
const productosPorPagina = 6;
let totalPaginas = 1;


// ------------------- RANDOM CON SEMILLA -------------------
function randomConSemilla(seed) {
  var x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

function shuffleConSemilla(array, semilla) {
  let copia = [...array];
  for (let i = copia.length - 1; i > 0; i--) {
    const j = Math.floor(randomConSemilla(semilla + i) * (i + 1));
    [copia[i], copia[j]] = [copia[j], copia[i]];
  }
  return copia;
}

// ------------------- USUARIO ÚNICO -------------------
function getUserId() {
  let userId = localStorage.getItem("userId");
  if (!userId) {
    userId = Math.floor(Math.random() * 1e9);
    localStorage.setItem("userId", userId);
  }
  return parseInt(userId);
}

// ------------------- SEMILLA DIARIA -------------------
function getDailySeed() {
  const today = new Date();
  const dia = today.getFullYear()*10000 + (today.getMonth()+1)*100 + today.getDate();
  const userId = getUserId();
  return dia + userId;
}

// ------------------- ORDEN PERSISTENTE -------------------

function obtenerOrdenProductos(lista) {
  const semilla = getDailySeed();
  const key = `ordenProductos-${semilla}`;

  let ordenGuardado = localStorage.getItem(key);
  let indices;

  if (ordenGuardado) {
    indices = JSON.parse(ordenGuardado);

    // --- AGREGAR NUEVOS PRODUCTOS ---
    const nuevos = lista.map((_, i) => i).filter(i => !indices.includes(i));
    if (nuevos.length > 0) {
      indices = [...indices, ...shuffleConSemilla(nuevos, semilla)];
    }

    // --- ELIMINAR PRODUCTOS QUE YA NO EXISTEN ---
    indices = indices.filter(i => i < lista.length);

    // Guardar el orden actualizado
    localStorage.setItem(key, JSON.stringify(indices));
  } else {
    // crear nuevo orden
    indices = shuffleConSemilla(lista.map((_, i) => i), semilla);
    localStorage.setItem(key, JSON.stringify(indices));
  }

  return indices.map(i => lista[i]);
  }





  
  

  async function cargarProductos() {  
  const respuesta = await fetch(API_URL);  
  listaProductos = await respuesta.json();  
  listaProductos = listaProductos.slice(1);
  listaProductos = obtenerOrdenProductos(listaProductos);
  mostrarProductosEnPantalla();  
  }







  
function generarEstrellas(valorEstado) {
  const valor = Number(valorEstado) / 2;
  let html = '';

  for (let i = 1; i <= 5; i++) {
    if (valor >= i) {
      html += '<span class="estrella llena">★</span>';
    } 
    else if (valor >= i - 0.5) {
      html += '<span class="estrella media">★</span>';
    } 
    else {
      html += '<span class="estrella vacia">★</span>';
    }
  }

  return `<span class="estrellas">${html}</span>`;
  }






  


function mostrarProductosEnPantalla() {
  const contenedor = document.getElementById('productos');
  
  totalPaginas = Math.ceil(listaProductos.length / productosPorPagina);
  const inicio = (paginaActual - 1) * productosPorPagina;
  const fin = inicio + productosPorPagina;
  const productosPagina = listaProductos.slice(inicio, fin);

  contenedor.innerHTML = productosPagina.map((producto,index)=>{
    const imagenes = [producto[7],producto[8],producto[9],producto[10],producto[11]].filter(url=>url && url.trim()!=="");
    const sliderId = `slider-${index}`;
    const dotsId = `dots-${index}`;
    const estrellas = generarEstrellas(producto[5]);

    return `
      <article class="producto">
        <div class="slider" id="${sliderId}">
          ${imagenes.map((img,i)=>`<img src="${img}" class="${i===0?'active':''}" alt="${producto[2]}" loading="lazy">`).join('')}
        </div>
        <div class="slider-dots" id="${dotsId}">
          ${imagenes.map((_,i)=>`<span class="${i===0?'active':''}"></span>`).join('')}
        </div>
        <p><strong>Código:</strong> ${producto[1]}</p>
        <p><strong>Estado:</strong> ${estrellas}</p>
        <h3>${producto[2]}</h3>
        <p>${producto[3]}</p>
        <p><strong>Precio:</strong> S/${producto[4]}</p>
        ${producto[6] === "Reservado"
? `<button disabled style="background:#999">Reservado</button>`
: `<button onclick="reservarProducto('${producto[2]}','${producto[1]}', this)">Comprar</button>`
  }
      </article>
    `;
  }).join('');

  productosPagina.forEach((_,i)=>inicializarSlider(i));

  actualizarPaginacion();
}




  

async function reservarProducto(nombreProducto, codigoProducto) {
  const respuesta = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "reservar", producto: nombreProducto })
  });

  const data = await respuesta.json();

  if(data.success){
    let mensaje = `Hola! Quiero comprar el producto: ${nombreProducto} (Código: ${codigoProducto})`;
    mensaje = encodeURIComponent(mensaje);
    window.open(`https://wa.me/51970984529?text=${mensaje}`, '_blank');
  } else {
    alert(data.mensaje);
  }
}

function inicializarSlider(index) {
  const slider = document.getElementById(`slider-${index}`);
  const dots = document.getElementById(`dots-${index}`).children;
  if(!slider) return;
  const imgs = slider.querySelectorAll("img");
  if(imgs.length<=1) return;

  let current = 0;
  let intervalo = setInterval(nextSlide, 3000);

  function nextSlide() {
    imgs[current].classList.remove("active");
    dots[current].classList.remove("active");
    current = (current + 1) % imgs.length;
    imgs[current].classList.add("active");
    dots[current].classList.add("active");
  }

  imgs.forEach(img=>img.addEventListener('click', ()=>{
    clearInterval(intervalo);
    document.getElementById('zoomImg').src = img.src;
    document.getElementById('zoomModal').style.display = 'flex';
  }));

  document.getElementById('zoomModal').addEventListener('click', ()=>{
    document.getElementById('zoomModal').style.display = 'none';
    intervalo = setInterval(nextSlide, 3000);
  });

  Array.from(dots).forEach((dot,i)=>{
    dot.addEventListener('click', ()=>{ cambiarSlide(i); });
  });

  let startX = 0;
  slider.addEventListener('mousedown', e=>{ startX=e.clientX; clearInterval(intervalo); });
  slider.addEventListener('mouseup', e=>{ manejarSwipe(e.clientX - startX); });
  slider.addEventListener('touchstart', e=>{ startX=e.touches[0].clientX; clearInterval(intervalo); });
  slider.addEventListener('touchend', e=>{ manejarSwipe(e.changedTouches[0].clientX - startX); });

  function manejarSwipe(diff){
    if(diff>50) current = (current-1+imgs.length)%imgs.length;
    else if(diff<-50) current = (current+1)%imgs.length;
    cambiarSlide(current);
    intervalo = setInterval(nextSlide, 3000);
  }

  function cambiarSlide(nuevo){
    imgs.forEach(img=>img.classList.remove("active"));
    Array.from(dots).forEach(dot=>dot.classList.remove("active"));
    current = nuevo;
    imgs[current].classList.add("active");
    dots[current].classList.add("active");
  }
}



function actualizarPaginacion() {
  const contenedor = document.getElementById('paginacion');
  contenedor.innerHTML = '';

  // Botón anterior
  const btnAnterior = document.createElement('button');
  btnAnterior.textContent = '‹';
  btnAnterior.disabled = paginaActual === 1;
  btnAnterior.onclick = () => cambiarPagina(-1);
  contenedor.appendChild(btnAnterior);

  let mostrar = [];
  const anchoPantalla = window.innerWidth;

  if (anchoPantalla <= 480) {
    // MÓVIL: mostrar 3 números alrededor de la página actual + primero y último
    mostrar.push(1); // primera página siempre
    if (paginaActual > 3) mostrar.push('...');

    const start = Math.max(2, paginaActual - 1);
    const end = Math.min(totalPaginas - 1, paginaActual + 1);

    for (let i = start; i <= end; i++) mostrar.push(i);

    if (paginaActual < totalPaginas - 2) mostrar.push('...');
    if (totalPaginas > 1) mostrar.push(totalPaginas); // última página siempre
  } else {
    // Escritorio: mostrar hasta 5 números alrededor de la página actual
    if (totalPaginas <= 7) {
      for (let i = 1; i <= totalPaginas; i++) mostrar.push(i);
    } else {
      mostrar.push(1);
      let start = Math.max(paginaActual - 2, 2);
      let end = Math.min(paginaActual + 2, totalPaginas - 1);

      if (start > 2) mostrar.push('...');
      for (let i = start; i <= end; i++) mostrar.push(i);
      if (end < totalPaginas - 1) mostrar.push('...');
      mostrar.push(totalPaginas);
    }
  }

  mostrar.forEach(i => {
    const span = document.createElement('span');
    if (i === '...') {
      span.textContent = '...';
      span.style.pointerEvents = 'none';
    } else {
      span.textContent = i;
      span.className = 'numero-pagina' + (i === paginaActual ? ' active' : '');
      span.onclick = () => { paginaActual = i; mostrarProductosEnPantalla(); };
    }
    contenedor.appendChild(span);
  });

  // Botón siguiente
  const btnSiguiente = document.createElement('button');
  btnSiguiente.textContent = '›';
  btnSiguiente.disabled = paginaActual === totalPaginas;
  btnSiguiente.onclick = () => cambiarPagina(1);
  contenedor.appendChild(btnSiguiente);
}



  
// Actualizar paginación al cambiar tamaño de ventana
window.addEventListener('resize', actualizarPaginacion);

    
cargarProductos();










  function cambiarPagina(direccion){
  paginaActual += direccion;
  if(paginaActual < 1) paginaActual = 1;
  if(paginaActual > totalPaginas) paginaActual = totalPaginas;
  mostrarProductosEnPantalla();
  }


  

</script>

</body>
                                                              </html>
